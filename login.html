<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <link rel="shortcut icon" type="x-icon" href="tokyotales.png">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width",initial-scale="1.0">
  <title >TokyoTales</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
	<link rel="stylesheet" href="login.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
		integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
	<div class="container">
            <div class="row center" style="margin-top: 48px;">
            </div>
		</div>
		<div class="row" style="margin-top: 80px;">
			<div class="center">
				<h1 class="title">Welcome back</h1>
			</div>
		</div>
		<div class="row" style="margin-top: 15px;">
			<div class="col-12 center">
				<input type="text" id="Email address" placeholder="Email address">
			</div>
		</div>
        <div class="row" style="margin-top: 15px;">
			<div class="col-12 center">
				<input type="password" id="password" placeholder="password">
			</div>
		</div>
		<div class="row" style="margin-top: 20px;">
			<div class="row" style="margin-top: 20px;">
        <div class="col-12 center">
          <input type="submit" id="login" value="login"> 
        </div>
      </div>
		</div>
		<div class="row" style="margin-top: 8px;">
			<div>
				<div class="col-12 center">
					<p>Don't have an account? <a href="signup.html">Sign up</a></p>
				</div>
			</div>
		</div>
		<div class="row">
			<div>

				</div>
			</div>
		</div>
	</div>
		<div>
			<div class="row" style="margin-top: 430px;">
				<div>
					<div class="col-12 center">
						<p style="color: #10a37f;">Terms of use | Privacy policy</p>
					</div>
				</div>
			</div>
		</div>
  <script src="script.js"></script>
</body>

<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
    import {getDatabase,set,ref,update} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword,signInWithEmailAndPassword,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyDyBtuIn9DbttlAJ4Tc7PonNtJdb0wFX64",
      authDomain: "tokyotales-8dfbb.firebaseapp.com",
      databaseURL: "https://tokyotales-8dfbb-default-rtdb.firebaseio.com",
      projectId: "tokyotales-8dfbb",
      storageBucket: "tokyotales-8dfbb.appspot.com",
      messagingSenderId: "265847784477",
      appId: "1:265847784477:web:7d891bdfd921dfb89672f4",
      measurementId: "G-DG6WQ7D334"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const database =getDatabase(app); 
    const auth =getAuth();

  login.addEventListener('click',(e)=>{
    var email=document.getElementById('Email address').value;
    var password=document.getElementById('password').value;
    signInWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
    // Signed in 
    const user = userCredential.user;

            const dt=new Date();
            update(ref(database,'users/'+ user.uid),{
                last_login:dt,
    // ...
  })
})
    // alert('user Logged in');
    window.location.href = "/index.html"
})
  .catch((error) => {
    const errorCode = error.code;
    const errorMessage = error.message;
  });
  
  alert(errorMessage);
const user=auth.currentUser;
onAuthStateChanged(auth, (user) => {
  if (user) {
    // User is signed in, see docs for a list of available properties
    // https://firebase.google.com/docs/reference/js/auth.user
    const uid = user.uid;
    // ...
  } else {
    // User is signed out
    // ...
  }
});

logout.addEventListener('click',(e)=>{
signOut(auth).then(() => {
  // Sign-out successful.
  alert('user logged out');
}).catch((error) => {

    const errorCode=errorCode;
        const  errorMessage=error.message;

        alert(errorMessage);
  // An error happened.
});


});
  

  </script>
</html>